<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="fontello/css/fontello.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Rubik:wght@300;400;500&display=swap"
        rel="stylesheet">
    <title>Emmet Drop - File transfer app</title>
</head>

<body>
    <div class="app">
        <div class="app-header">Emmet Drop</div>
        <div class="link-related">
            <div class="qr link-related-item">
                <div class="qr-header">Scan QR</div>
                <img src="code.jpg" width="128" height="128">
            </div>
            <div class="separator">or</div>
            <div class="sharelink link-related-item">
                <div class="sharelink-header">Link to share</div>
                <div class="link-wrapper">
                    <input class="link" type="text" value="https://EmmetDropper.com/c/66789212" readonly>
                    <button class="link-button">Copy Link<span class="mdi mdi-clipboard-multiple" style="padding-left: 5px;"></span></button>
                </div>
            </div>
        </div>
        <div class="devices">
            <div class="devices-header">Available devices</div>
            <div class="device-list">
                <div class="device" id="awds"><i class="icon-bluetooth"></i>Redmi 8T</div>
                <div class="device" id="daws"><i class="icon-bluetooth"></i>Huawei P90</div>
                <div class="device" id="1234"><i class="icon-wifi"></i>Samsung Galaxy S6</div>
                <div class="device" id="asdw"><i class="icon-bluetooth"></i>Opopeo S6</div>
            </div>
        </div>
        <button class="upload-button">Choose File</button>
    </div>
    <script>
        let checkMode = false;
        let pressDuration;
        let devices = document.getElementsByClassName('device');

        let checkDuration = 1000;

        let checkedList = [];

        //Check press
        Array.from(devices).forEach((e) => {
            CheckDivPressDuration(e);
        })

        //Set multiple choices
        Array.from(devices).forEach((e) => {
            e.addEventListener('click', CheckDevice);
        })

        //Turn off checkmode
        document.addEventListener("click", (e) => {
            if (checkMode && (e.target.className != "device" && e.target.tagName != "BUTTON" && e.target.tagName != "INPUT")) {
                checkMode = false;
                Array.from(devices).forEach((device) => {
                    device.removeChild(device.childNodes[0]);
                    checkedList = [];
                })
            }
        });

        function CheckDivPressDuration(divElement) {
            let pressStartTime;
            let pressIntervalId;

            function HandleMouseDown() {
                pressStartTime = Date.now();
                pressIntervalId = setInterval(CheckPressDuration, 100);
            }

            function HandleMouseUp(e) {
                pressDuration = Date.now() - pressStartTime;
                clearInterval(pressIntervalId);
                pressStartTime = undefined;
            }

            function ResetDuration() {
                clearInterval(pressIntervalId);
                pressStartTime = undefined;
            }

            function CheckPressDuration() {
                if (pressStartTime) {
                    const pressDuration = Date.now() - pressStartTime;
                    if (pressDuration >= checkDuration) {
                        if (!checkMode) {
                            Array.from(devices).forEach((e) => {
                                let checkbox = document.createElement("i");
                                checkbox.className = "mdi mdi-checkbox-blank-outline";
                                e.prepend(checkbox);
                            })
                            checkMode = true;
                        }
                    }
                }
            }

            divElement.addEventListener("mouseleave", ResetDuration);
            divElement.addEventListener("mousedown", HandleMouseDown);
            divElement.addEventListener("mouseup", HandleMouseUp);
        }

        function CheckDevice(e) {
            if (checkMode && pressDuration < checkDuration) {
                if (!checkedList.includes(e.target.id)) {
                    e.target.childNodes[0].className = "mdi mdi-checkbox-marked";
                    checkedList.push(e.target.id);
                }
                else {
                    e.target.childNodes[0].className = "mdi mdi-checkbox-blank-outline";
                    checkedList.splice(checkedList.indexOf(e.target.id), 1);
                }
            }
            console.log(checkedList);
        }
    </script>
</body>

</html>